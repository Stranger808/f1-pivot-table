<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PivotTable Data Analysis</title>
    
    <!-- jQuery (required by PivotTable.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    
    <!-- jQuery UI (required for drag and drop) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/themes/base/jquery-ui.min.css">
    
    <!-- PivotTable.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.23.0/pivot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.23.0/pivot.min.css">
    
    <!-- Plotly for charts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.27.0/plotly.min.js"></script>
    
    <!-- PivotTable Plotly Renderers -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.23.0/plotly_renderers.min.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css?v=4">
</head>
<body>
    <div class="container">
        <h1>PivotTable Data Analysis</h1>
        
        <!-- Pivot Table Container -->
        <div id="pivot-container">
            <div id="pivot-output"></div>
            <div class="loading" id="pivot-loading">
                <div class="spinner"></div>
                <p>Initializing PivotTable...</p>
            </div>
        </div>
        
        <!-- Query Input Section -->
        <div class="query-section">
            <h3>Enter Your Query</h3>
            <textarea id="query-input" placeholder="Enter your PostgreSQL query here..."></textarea>
            <div class="button-container">
                <button id="submit-btn" onclick="submitQuery()">Submit</button>
            </div>
            <div class="error" id="error-message"></div>
        </div>
        
        <!-- Results Section -->
        <div class="results-section" id="results-section">
            <div class="results-header">
                <div class="results-info">
                    <h4>Query Results</h4>
                    <p>Page <span id="current-page">1</span> of <span id="total-pages">1</span> - 
                       <span id="total-rows">0</span> total rows</p>
                </div>
                <a href="#" class="download-link" id="download-csv" onclick="downloadCSV(event)">Download Full CSV</a>
            </div>
            <div class="table-container">
                <table id="results-table">
                    <thead id="table-header"></thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
            <div class="pagination">
                <button onclick="previousPage()" id="prev-btn">Previous</button>
                <button onclick="nextPage()" id="next-btn">Next</button>
            </div>
        </div>
    </div>
    
    <script src="config.js"></script>
    <script src="app.js?v=5"></script>
</body>
</html>